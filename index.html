<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ianlrsn links</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="stage" aria-hidden="true"></div>
    <main class="page">
      <section class="card">
        <header class="hero">
          <div class="avatar" role="img" aria-label="Ian">
            <div class="avatar-media" aria-hidden="true"></div>
            <div class="avatar-word" aria-hidden="true">ian</div>
          </div>
          <p class="handle">@ianlrsn</p>
          <div class="socials" aria-label="social links">
            <a class="social" href="https://www.twitch.tv/ianlrsn" aria-label="Twitch">
              <img src="icons/twitch.svg" alt="" aria-hidden="true" />
            </a>
            <a class="social" href="https://tiktok.com/@ianlrsn" aria-label="TikTok">
              <img src="icons/tiktok.svg" alt="" aria-hidden="true" />
            </a>
            <a class="social" href="https://discord.gg/kdjjzfKE" aria-label="Discord">
              <img src="icons/discord.svg" alt="" aria-hidden="true" />
            </a>
            <a class="social" href="https://www.instagram.com/ianlrsn" aria-label="Instagram">
              <img src="icons/instagram.svg" alt="" aria-hidden="true" />
            </a>
            <a class="social" href="https://youtube.com/@ianlrsn?si=PY8eBxGL5ZDL8J9h" aria-label="YouTube">
              <img src="icons/youtube.svg" alt="" aria-hidden="true" />
            </a>
            <!-- Cash App icon removed; restore when donations link is ready. -->
          </div>
        </header>
        <section class="links">
          <a class="link" href="https://www.twitch.tv/ianlrsn" data-twitch>
            <span class="thumb">
              <img src="icons/twitch.svg" alt="" aria-hidden="true" />
            </span>
            <span class="label">Twitch @ianlrsn</span>
            <span class="dots">&#8942;</span>
          </a>
          <a class="link" href="https://tiktok.com/@ianlrsn">
            <span class="thumb">
              <img src="icons/tiktok.svg" alt="" aria-hidden="true" />
            </span>
            <span class="label">TikTok @ianlrsn</span>
            <span class="dots">&#8942;</span>
          </a>
          <a class="link" href="https://discord.gg/kdjjzfKE">
            <span class="thumb">
              <img src="icons/discord.svg" alt="" aria-hidden="true" />
            </span>
            <span class="label">Discord @ianlrsn</span>
            <span class="dots">&#8942;</span>
          </a>
          <a class="link" href="https://www.instagram.com/ianlrsn">
            <span class="thumb">
              <img src="icons/instagram.svg" alt="" aria-hidden="true" />
            </span>
            <span class="label">Instagram @ianlrsn</span>
            <span class="dots">&#8942;</span>
          </a>
          <a class="link" href="https://youtube.com/@ianlrsn?si=PY8eBxGL5ZDL8J9h">
            <span class="thumb">
              <img src="icons/youtube.svg" alt="" aria-hidden="true" />
            </span>
            <span class="label">YouTube @ianlrsn</span>
            <span class="dots">&#8942;</span>
          </a>
          <a class="link" href="#">
            <span class="thumb nintendo">
              <img src="icons/nintendo.svg" alt="" aria-hidden="true" />
            </span>
            <span class="label">Nintendo Â· SW-6525-1278-1508</span>
            <span class="dots">&#8942;</span>
          </a>
          <!-- Cash App tile removed; restore when donations link is ready. -->
        </section>
      </section>
    </main>
    <script>
      const CYCLE_MS = 600;
      const CUT_FLASH_MS = 110;
      const stage = document.querySelector(".stage");
      const card = document.querySelector(".card");
      const avatarMedia = document.querySelector(".avatar-media");
      const avatarWord = document.querySelector(".avatar-word");
      let index = 0;
      let cycleTimer = null;
      const sequence = [
        { type: "image", bg: "#8acd00" },
        { type: "word", text: "live", bg: "#2750ff", color: "#ff2b2b" },
        { type: "word", text: "right now", bg: "#ff2b2b", color: "#b7ff00" },
        { type: "word", text: "twitch", bg: "#9146ff", color: "#ffffff" },
        {
          type: "word",
          text: "tiktok",
          bg: "#000000",
          color: "#ffffff",
        },
        { type: "word", text: "watch", bg: "#000000", color: "#ffffff" },
      ];

      const stepCycle = () => {
        const step = sequence[index % sequence.length];
        if (stage) stage.style.setProperty("--stage-color", "#000000");
        if (card) card.classList.add("live-mode");
        if (avatarMedia && avatarWord) {
          avatarMedia.classList.remove("show");
          avatarWord.classList.remove("show");
        }

        setTimeout(() => {
          const bg = step.bg || "#8acd00";
          if (stage) stage.style.setProperty("--stage-color", bg);
          if (avatarMedia && avatarWord) {
            avatarWord.className = "avatar-word";
            avatarWord.style.color = step.color || "#000";
            avatarWord.style.background = bg;
            if (step.type === "image") {
              avatarMedia.classList.add("show");
            } else {
              avatarWord.textContent = step.text;
              avatarWord.classList.add("show");
            }
          }
        }, CUT_FLASH_MS);

        index += 1;
      };

      const startCycle = () => {
        if (cycleTimer) return;
        if (card) card.classList.add("live-mode");
        stepCycle();
        cycleTimer = setInterval(stepCycle, CYCLE_MS);
      };

      const stopCycle = () => {
        if (cycleTimer) {
          clearInterval(cycleTimer);
          cycleTimer = null;
        }
        if (stage) stage.style.setProperty("--stage-color", "#8acd00");
        if (card) card.classList.remove("live-mode");
        if (avatarMedia && avatarWord) {
          avatarMedia.classList.add("show");
          avatarWord.className = "avatar-word";
          avatarWord.classList.remove("show");
          avatarWord.textContent = "";
          avatarWord.style.color = "#000";
          avatarWord.style.background = "var(--hot-red)";
        }
      };

      const twitchRow = document.querySelector("[data-twitch]");
      const params = new URLSearchParams(window.location.search);
      const testLive = params.get("test_live") === "1";
      const forceLive = params.get("force_live") === "1";
      if (forceLive && card) card.classList.add("live-mode");

      const checkTwitchLive = async () => {
        if (!twitchRow) return;
        if (testLive) {
          twitchRow.classList.add("is-live");
          startCycle();
          return;
        }
        try {
          const response = await fetch("/api/twitch-live", { cache: "no-store" });
          if (!response.ok) throw new Error("status fetch failed");
          const data = await response.json();
          const isLive = Boolean(data?.live);
          twitchRow.classList.toggle("is-live", isLive);
          if (isLive) {
            startCycle();
          } else {
            stopCycle();
          }
        } catch (error) {
          twitchRow.classList.remove("is-live");
          stopCycle();
        }
      };

      stopCycle();
      checkTwitchLive();
      setInterval(checkTwitchLive, 60000);
    </script>

  </body>
</html>
